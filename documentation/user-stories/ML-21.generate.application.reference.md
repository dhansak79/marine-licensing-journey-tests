# ML-21: Generate Application Reference

## User Story

**AS** an applicant  
**I WANT** a unique reference for my exemption notification  
**SO THAT** I can keep track of my notification

## Background

At the point that the user submits their exemption notification, the service will generate a unique reference for it. This reference will follow the same format as the existing reference numbers generated by MCMS, but will have a different 'seed' number, to avoid the possibility of any duplication with MCMS. For example MCMS-issued numbers may start at '00001' whereas reference numbers issued by the new service may start at '10001'.

Note that until the point of submission, the exemption notification will not have a (user facing) unique reference. This is to avoid numbers being issued for draft notifications that never actually get submitted.

## Resources

N/A

## Out of scope

There will be no checking with MCMS to ensure the uniqueness of the reference number. We will rely on the seed numbering to avoid duplicates.

## Questions and answers

TBC

## Screenshots

N/A

## Acceptance criteria

### AC1 - Generate application reference

**GIVEN** I am on the "Check your answers" page (see [ML-82](https://eaflood.atlassian.net/browse/ML-82))

**WHEN** I submit my exemption notification

**THEN** a unique application reference will be generated in the format "\<prefix\>/\<year\>/\<sequence number\>" e.g. "EXE/2025/12345":

- **\<prefix\>** - contains fixed text "EXE" for an exemption (this prefix will vary as we build other journeys such as marine licences, enquiries etc)
- **\<year\>** - this is the 4 digit year in which the application reference was generated
- **\<sequence number\>** - a sequential 5 digit number for the exemption:
  - the 'seed' number (the number that we start at) for the sequence will be 10001 (since we are replicating the number format currently used by MCMS, we need to ensure that the 'seed' number is sufficiently high that there will be no overlap with those issued by MCMS)
  - the sequence number will increment by one each time
  - this sequence of numbers is specific to exemptions, there will be other sequences for other application types such as marine licences, enquiries etc.
  - the sequence will reset back to the 'seed' number at the start of every year, so that the first application reference generated each year will have a sequence number of 10001 (TBC) e.g. "EXE/2026/10001"

**AND** the reference number is saved against the notification as expected

---

## Implementation Status

### âœ… Completed Implementation

- **Core reference generation functionality** - Unique application reference generated upon notification submission
- **Format validation** - EXE/{year}/{sequence} format correctly implemented and tested
- **Sequence numbering** - 5-digit sequence numbers starting from seed value 10001
- **Annual reset capability** - Reference system designed to reset sequence yearly
- **Integration with submission workflow** - Reference generation integrated into submit notification flow
- **Test automation** - Comprehensive validation of reference format and numbering in feature tests

### Implementation Details

1. **Reference Format**: Validated to match `EXE/{current year}/{number > 10000}` pattern
2. **Integration Point**: Embedded within submit notification feature (`submit.notification.feature`)
3. **Validation Logic**:
   - Format verification using regex pattern
   - Year validation against current year
   - Sequence number validation (greater than 10000 seed)
4. **Test Coverage**: Reference generation tested as part of notification submission workflow

### Technical Implementation

- **Feature File**: `test/features/submit.notification.feature`
- **Validation Component**: `test-infrastructure/screenplay/interactions/ensure.confirmation.page.js`
- **Page Object**: `test-infrastructure/pages/confirmation.page.js`
- **Integration**: Part of ML-84 submit notification user journey

**Priority:** Complete - Full application reference generation functionality implemented and tested according to AC1 requirements.
