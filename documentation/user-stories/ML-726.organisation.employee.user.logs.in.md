# ML-726: Organisation 'Employee' User Logs In

## User Story

**AS** an 'employee' user  
**I WANT** to be able to log in and carry out work for my organisation  
**SO THAT** my work is associated with my organisation

## Background

The service currently supports individual users logging in and creating notifications. The notifications are created against the user themselves, and there is no organisation information against them. However, many users of the new service will be creating notifications as part of their job, and so will be logging in as an employee of an organisation.

This story covers the process of receiving the organisation information from Defra ID (where users and their employee relationships with organisations are managed), and using that organisation information at various stages in the notification process:

- Displaying the organisation name in the header
- Creating notifications against the organisation
- Submitting the organisation when a notification is submitted to Dynamics
- Displaying the organisation in the email confirmation
- Filtering the dashboard to only show the notifications that the user has created for the organisation

Once this story is delivered, we will be able to support both individual users and employee users. Additional work will be required to support users who are employed by 'agent' organisations, who do work on behalf of other organisations.

## Resources

- Link to prototype showing organisation name

## Out of Scope

This story does not cover scenarios where there is an agent-client relationship - that is, where the applicant organisation is acting as an 'agent', is applying on behalf of another 'client' organisation.

This story does not cover the 'organisation picker' capability.

## Questions and Answers

TBC

## Screenshots

### Screenshot 1: Example Application Page Showing Organisation Name in Header

**Page layout showing:**

- Standard GOV.UK header with crown logo and "GOV.UK" branding
- Blue service header containing "Get permission for marine work" as the service name
- Navigation area on the right side of the service header containing "Projects", "Defra account", and "Sign out" links
- **"Brighton Marina Operations" displayed prominently in the header** as the applicant organisation name, providing clear context to the employee user about which organisation they are currently working for
- Beta banner with blue background stating "This is a new service. Help us improve it and give your feedback (opens in new tab)." with an underlined feedback link
- Back link for navigation to return to the previous page
- "Worthing pontoon project" displayed as the project name caption above the main heading
- "Exempt activity notification" as the page identifier
- "Task list" as the main H1 heading
- Task list sections including:
  - "Project name" task marked as "Completed"
  - "Site details" task marked as "Not yet started"
  - "Public register" task marked as "Not yet started"
- Standard GOV.UK footer with licensing and regulatory information

### Screenshot 2: Confirmation Email Content for Organisation Employee Users

**Email content showing:**

- **Subject line area** (standard email template layout)
- Personalised greeting: "Dear ((name))"
- Opening confirmation text: "Thank you for sending us details of your activity."
- **Grey highlighted information box** containing:
  - "Your reference number :((reference))"
  - **"Your organisation : ((organisationName))"** - Key addition showing the employee user's organisation context
- Main body text: "Based on the answers you gave us, your activity does not need a marine licence."

## Acceptance Criteria

### AC1 - Organisation user logs in

**GIVEN** I am logging in as an employee user (i.e. I am set up in Defra ID as an employee of an organisation)  
**WHEN** I log in  
**THEN** the identity of my organisation is received from Defra ID  
**AND** the ID of the organisation is maintained against my session as the "Applicant organisation"

### AC2 - Display organisation

**GIVEN** I have logged in as an employee user  
**WHEN** I view any page within the application journey (except the file upload 'spinner' page)  
**THEN** I see the name of the "Applicant organisation" in the header (as per the attached screenshot)

**NOTE** - the name of the organisation is available in the token from Defra ID, along with the GUID

### AC3 - Create exemption notification

**GIVEN** I have logged in as an employee user  
**WHEN** I create a new notification  
**THEN** the notification is tagged with the ID of the "Applicant organisation" from my session  
**AND** the name of the organisation (text) is also stored

### AC4 - Submit exemption notification

**GIVEN** I have logged in as an employee user  
**WHEN** I submit a notification  
**THEN** the notification is submitted to Dynamics 365 with ID of the "Applicant organisation" from my session (see https://eaflood.atlassian.net/browse/ML-703)

### AC5 - Send confirmation email

**GIVEN** I have logged in as an employee user  
**WHEN** I submit an exemption notification  
**THEN** the email confirmation contains the name of the "Applicant organisation" from my session (see attached screenshot)

**NOTE** - this may be done either as a new Gov.Notify email template (to be used only in cases where the applicant is an employee user) or it may be added as optional text in the existing email template delivered under https://eaflood.atlassian.net/browse/ML-95.

### AC6 - View dashboard

**GIVEN** I have logged in as an employee user  
**WHEN** I view the dashboard  
**THEN** I see exemption notifications that are tagged with the "Applicant organisation" from my session  
**AND** I don't see any notifications for any other organisations  
**AND** I don't see any notifications created by any other employees of the same organisation

**NOTE** - this will support the scenario where the same person works for >1 organisation, and has created notifications across some or all of those organisations. The intention here is that - for this session, where they chose Organisation A at login - that they only see their notifications for Organisation A on their dashboard. If they were to log in later and choose Organisation B at login, their dashboard would only show their notifications from organisation B

## Test Scenarios

In order to test this ticket, different test users will need to be set up:

**USER A** - organisation user, set up against a single organisation (ORGANISATION 1). USER A should have set up some notifications (both draft and submitted).

**USER B and USER C** - organisation users, set up against at least two organisations (ORGANISATION 1, ORGANISATION 2 etc). USER B and USER C should have set up some notifications (both draft and submitted) against each of the organisations they have access to. These users will allow us to verify that the service only displays the notifications for a specific user and organisation.

## Standard Behaviour

**Organisation context** - when I log in as an employee user, the organisation context is maintained throughout my session and influences which notifications I can view and interact with.

**Data isolation** - notifications created by different employees of the same organisation are kept separate, ensuring that each employee only sees their own work.

**Multi-organisation support** - if I am an employee of multiple organisations, I can work with different organisations in different sessions, with the dashboard and notification list filtered appropriately for the current session's organisation context.

**Organisation display** - the organisation name is consistently displayed in the header across all pages (except file upload spinner) to provide clear context about which organisation I am currently working for.

**Data persistence** - when I create or submit a notification as an organisation employee, both the organisation ID (GUID) and organisation name (text) are stored for proper tracking and reporting.
