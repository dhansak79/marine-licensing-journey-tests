# ML-675: CYA - display "Purpose of the activity" in the Project Summary card

## User Story

**AS** an applicant  
**I WANT** to see the purpose of the activity (as defined by the legislation)  
**SO THAT** I can understand the activity as MMO will understand it

## Background

Displaying the purpose of the activity was split from story https://eaflood.atlassian.net/browse/ML-142 as there was still some outstanding questions about the logic used to populate it. This story now implements the logic to display the purpose of the activity (based on the activity type and article number received from Fivium as per https://eaflood.atlassian.net/browse/ML-111.

## Resources

"Check your answers" page showing purpose of activity in multiple sites prototype v2

Exemption activity descriptions.xlsm

## Screenshots

### Check Your Answers Page - Project Summary Card with Purpose of Activity

The "Check your answers before sending your information" page displays the project summary card at the top. The card shows comprehensive project information including the project name "South coast sea samples", the type of activity "Removal of a substance or object", and critically **"The purpose of the activity"** row displaying "Samples for testing and analysis". This purpose is automatically determined based on the activity type (REMOVAL) and article number (17A) combination received from the IAT. The card also includes the exemption basis referencing Article 17A of the Marine Licensing (Exempted Activities) Order 2011, a "Change" link aligned to the right for the project name, and a link to download the user's answers from the IAT as a PDF. Instructional text below explains how to modify IAT answers by deleting the project and starting again.

## Acceptance Criteria

### AC1 - display "Purpose of the activity" row

**GIVEN** I am viewing the "Check your answers" page OR the "View details" page  
**WHEN** I view the "Project summary" card (introduced in https://eaflood.atlassian.net/browse/ML-142)  
**THEN** I see the I view the "Purpose of the activity" row populated based on the activity type code and article number as defined below  
**AND** if the notification contains any combination of activity type code and article number not listed below then the "Purpose of the activity" row will not be displayed

| Activity type code | Article number | Text to display                                            |
| ------------------ | -------------- | ---------------------------------------------------------- |
| CON                | 25             | "Moorings or aids to navigation"                           |
|                    | 25A            | "Pontoons"                                                 |
|                    | 35             | "Bored tunnels"                                            |
| DEPOSIT            | 13             | "Shellfish propagation or cultivation"                     |
|                    | 17             | "Scientific instruments and associated equipment"          |
|                    | 20             | "Flood or flood risk"                                      |
|                    | 25             | "Moorings or aids to navigation"                           |
|                    | 25A            | "Pontoons"                                                 |
|                    | 26             | "Markers for European marine sites and conservation zones" |
|                    | 26A            | "Temporary markers"                                        |
|                    | 34             | "Cables and pipelines"                                     |
| REMOVAL            | 13             | "Shellfish propagation or cultivation"                     |
|                    | 17             | "Scientific instruments and associated equipment"          |
|                    | 17A            | "Samples for testing or analysis"                          |
|                    | 17B            | "Accidental deposits"                                      |
|                    | 20             | "Flood or flood risk"                                      |
|                    | 21             | "Dead animals"                                             |
|                    | 25             | "Moorings or aids to navigation"                           |
|                    | 25A            | "Pontoons"                                                 |
|                    | 26             | "Markers for European marine sites and conservation zones" |
|                    | 26A            | "Temporary markers"                                        |
|                    | 34             | "Cables and pipelines"                                     |
| DREDGE             | 18A            | "Navigational dredging"                                    |
|                    | 20             | "Flood or flood risk"                                      |
|                    | 34             | "Cables and pipelines"                                     |

**NOTE** - this means that the "Purpose of the activity" row will never be displayed for incineration, explosives and scuttling activities.

---

## Implementation Status

### ✅ Completed Implementation

- **Activity purpose logic** - Complete mapping of activity type and article combinations to purpose descriptions
- **Conditional display** - Purpose row only shown for valid activity type/article combinations
- **Project summary card integration** - Purpose displays in both Check Your Answers and View Details pages
- **IAT context dependency** - Purpose derived from ML-111 IAT context (activity type and article)
- **Complete test automation** - Purpose of activity validated across all IAT context test scenarios

### Technical Implementation Details

1. **Purpose Mapping**: Logic implemented to determine purpose text based on activity type and article number combinations
2. **Supported Combinations**:
   - **CON**: Articles 25, 25A, 35 (3 purposes)
   - **DEPOSIT**: Articles 13, 17, 20, 25, 25A, 26, 26A, 34 (8 purposes)
   - **REMOVAL**: Articles 13, 17, 17A, 17B, 20, 21, 25, 25A, 26, 26A, 34 (11 purposes)
   - **DREDGE**: Articles 18A, 20, 34 (3 purposes)
3. **Excluded Activity Types**: INCINERATION, EXPLOSIVES, SCUTTLING never display purpose
4. **Template Integration**: Purpose row conditionally rendered in project summary card component
5. **View Details Integration**: Purpose displays consistently across CYA and dashboard view details

### Test Coverage

**✅ Purpose of Activity Scenarios (covered by check.your.answers.feature)**:

1. **Valid activity type and article combinations** - Purpose text displayed correctly for all 25 mapped combinations
2. **Invalid combinations** - Purpose row not displayed when activity type/article combination not in mapping
3. **Excluded activity types** - INCINERATION, EXPLOSIVES, SCUTTLING never show purpose row
4. **IAT context integration** - Purpose derives correctly from IAT parameters across all user journeys

### Integration Points

- **IAT Context (ML-111)**: Purpose determined from ACTIVITY_TYPE and ARTICLE query parameters
- **Project Summary Card (ML-142)**: Purpose row added to existing project summary card component
- **Check Your Answers (ML-82, ML-139, ML-140)**: Purpose displays on CYA page for all site types
- **Dashboard View Details (ML-96)**: Purpose displays when viewing submitted notification details
- **All Test Scenarios**: IAT context with purpose validation integrated across complete test suite

**Priority:** Complete - Activity purpose logic fully implemented with comprehensive mapping, conditional display rules, and integration across Check Your Answers and View Details pages with complete test coverage.
